(function(a,b){a.widget("ui_add.autosizepanel",{base_class:"ui_add-autosizepanel",browser:2,ct:null,ini:null,options:{disabled:null,maxHeight:Number.POSITIVE_INFINITY,maximized:false,minHeight:0,resize:a.noop,scroll:a.noop,showHScrollBar:true,showVScrollBar:true},_check:function(){if(a("."+this.base_class,this.element.parent()[0]).length>1){throw"Only single instance of the autosize panel allowed for the same parent node."}else{if((this.options.minHeight>0)&&(this.options.maxHeight>0)&&(this.options.maxHeight<this.options.minHeight)){throw"The minimal height cannot be greater than maximal height."}}},_create:function(){var c=this;if(typeof(this.options.disabled)!=="boolean"){this.options.disabled=!!this.element.attr("disabled")}else{this.element.attr("disabled",this.options.disabled)}this.browser=window.innerHeight?2:(jQuery.support.shrinkWrapBlocks?0:1);this._check();if(this.browser){this.ini={height:this.element.css("height"),maxH:parseInt(this.element.css("max-height"))||0,minH:parseInt(this.element.css("min-height"))||0,overflow:this.element.css("overflow"),overflowX:this.element.css("overflow-x"),overflowY:this.element.css("overflow-y")};this.ct=this.element;this.element.addClass(this.base_class).css({height:"auto","overflow-x":this.options.showHScrollBar?"auto":"hidden","overflow-y":this.options.showVScrollBar?"auto":"hidden"}).bind("DOMSubtreeModified."+this.widgetName,function(d){return c._fill(d)}).bind("propertychange."+this.widgetName,function(d){if(!((d.originalEvent.propertyName=="height")||(d.originalEvent.propertyName=="width"))){return}alert("Property change");return c._fill(d)}).bind("resize."+this.widgetName,function(d){alert("Element resize");return c._fill(d)});a(window).bind("resize",function(d){return c._fill(d)})}else{this.ini={border:{bottom:this.element.css("border-bottom"),left:this.element.css("border-left"),right:this.element.css("border-right"),top:this.element.css("border-top")},height:this.element.css("height"),margin:this.element.css("margin"),maxH:parseInt(this.element.css("max-height"))||0,minH:parseInt(this.element.css("min-height"))||0,overflow:this.element.css("overflow"),overflowX:this.element.css("overflow-x"),overflowY:this.element.css("overflow-y"),padding:this.element.css("padding")};this.ct=this.element.wrap("<div style='overflow:hidden;overflow-x:hidden;overflow-y:hidden;' />").parent().css({"border-bottom":this.element.css("border-bottom"),"border-left":this.element.css("border-left"),"border-right":this.element.css("border-right"),"border-top":this.element.css("border-top"),margin:this.element.css("margin"),padding:this.element.css("padding")}).height(this.ini.height).bind("scroll."+this.widgetName,function(d){return c._scroll(d)});this.element.addClass(this.base_class).css({border:"0px",height:"0",margin:"0px","overflow-y":"visible","overflow-x":"visible",padding:"0px"}).add(window,this.ct.parent().not("body")).bind("resize."+this.widgetName,function(d){return c._fill(d)})}if(this.ini.minH){this.options.minHeight=this.ini.minH}if(this.ini.maxH){this.options.maxHeight=this.ini.maxH}this._setOption("disabled",this.options.disabled);this._fill()},_fill:function(n){function c(p){var d=0;p=p||q.element.parent();a(p).children().each(function(s,r){var t=a(r).css("position");if(!((t==="absolute")||(t==="fixed"))){d=Math.max(d,(q.browser?a(r).position().top:a(r)[0].offsetTop)+a(r).outerHeight(true))}});return d}if(this.options.disabled){return false}var j=0,f=this.ct.parent(),i=f.height(),m=f.width(),k=this.ct.height(),e=this.ct.outerHeight(),h=this.ct.outerWidth(true),l=this.element.outerHeight(),q=this;if(f.is("body")){switch(this.browser){case 0:j=f.height();break;case 1:j=2*f.parent()[0].clientHeight-f.parent().height()-f.outerHeight()+f.height();break;default:j=window.innerHeight}if((j>=0)&&(j!==i)){i=f.height(j).height()}}try{if(this.browser){if(f.is("body")){f.height(!this.browser?f[0].clientHeight:(this.browser===1?2*f.parent()[0].clientHeight-f.parent().height()-f.outerHeight()+f.height():window.innerHeight-f.parent().height()+f.height()))}j=f.height()-c(f);j=((j<0)&&(k+j<this.options.minHeight)?this.options.minHeight-k:((j>0)&&(k+j>this.options.maxHeight)?this.options.maxHeight-k:j));this.ct.css("max-height",k+j);if(this.options.maximized){this.ct.css("height",k+j)}if(!q.options.showVScrollBar){q.ct.css("overflow-y","hidden")}if(!q.options.showHScrollBar){q.ct.css("overflow-x","hidden")}return !!j}else{function g(w){if(!w){return false}if(w<0){var v=q.options.showVScrollBar?"auto":"hidden";if(q.ct.css("overflow-y")!==v){q.ct.css("overflow-y",v)}v=q.options.showHScrollBar?"auto":"hidden";if(q.ct.css("overflow-x")!==v){q.ct.css("overflow-x",v)}if(q.options.minHeight>0){return k!==q.ct.height(e+w<q.options.minHeight?q.options.minHeight:e+w).height()}else{return k!==q.ct.height(e+w<=0?0:((q.options.maxHeight>0)&&(e+w>q.options.maxHeight)?q.options.maxHeight:e+w)).height()}}else{var t=q.ct.parent(),u=t.height(),r=u-c(t)+e,s=0;if(e+w>r){w=r-e}if(!w){return false}s=(q.options.maxHeight>0)&&(e+w>q.options.maxHeight)?q.options.maxHeight:e+w;if(s===k){return false}if(q.ct.css("overflow-y")!=="hidden"){q.ct.css("overflow-y","hidden")}q.ct.height(s);if(q.options.showVScrollBar){q.ct.css("overflow-y","auto")}var v=q.options.showHScrollBar?"auto":"hidden";if(q.ct.css("overflow-x")!==v){q.ct.css("overflow-x",v)}return q.ct.height()!==k}}if(this.options.maximized){return g(i-c(f))}var o=i-c(f)+e;if(e+j>o){j=o-e}if(j<0){return g(j)}j=Math.min(c(this.element),l)-k;if(!j){return false}if(j<0){return g(j)}return g(this.element.height()-k)}}finally{this._trigger("resize",n,this.ui())}},_scroll:function(c){this._trigger("scroll",c,this.ui())},_setOption:function(c,d){a.Widget.prototype._setOption.apply(this,arguments);if((c==="maximized")||(c==="maxHeight")||(c==="minHeight")){this._fill()}},destroy:function(){this.element.removeClass(this.base_class);if(this.browser){this.element.unbind("DOMSubtreeModified."+this.widgetName);a(window).unbind("resize."+this.widgetName);this.element.css({height:this.ini.height,"max-height":this.ini.maxH,"min-height":this.ini.minH,overflow:this.ini.overflow,"overflow-y":this.ini.overflowX,"overflow-x":this.ini.overflowY})}else{this.element.add(window,this.ct.parent().not("body")).unbind("resize."+this.widgetName);this.element.unwrap().css({"border-bottom":this.ini.border.bottom,"border-left":this.ini.border.left,"border-right":this.ini.border.right,"border-top":this.ini.border.top,height:this.ini.height,margin:this.ini.margin,overflow:this.ini.overflow,"overflow-y":this.ini.overflowX,"overflow-x":this.ini.overflowY,padding:this.ini.padding})}this.element.removeClass(this.base_class);a.Widget.prototype.destroy.call(this)},clientHeight:function(){return this.ct[0].clientHeight},clientWidth:function(){return this.ct[0].clientWidth},height:function(){return this.ct.height()},outerHeight:function(c){return this.ct.outerHeight(c)},outerWidth:function(c){return this.ct.outerWidth(c)},refresh:function(){return this._fill()},widget:function(){return this.element},width:function(){return this.ct.width()},ui:function(){return{container:this.ct,element:this.element}}})}(jQuery));